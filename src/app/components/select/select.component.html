<div class="inline-block">
  <div>
    <button
      #button
      type="button"
      (click)="toggle(); $event.stopPropagation()"
      (keydown)="$event.key === 'Escape' && close()"
      [class]="
        'inline-flex items-center gap-2 px-3 py-2 border rounded ' +
        (buttonClass || '')
      "
      aria-haspopup="listbox"
      [attr.aria-expanded]="open()"
    >
      @if (selectedIcon()) {
        <span class="text-base">{{ selectedIcon() }}</span>
      }
      <span class="flex-1 text-left">{{
        selectedLabel() || placeholder
      }}</span>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" class="ml-2">
        <path
          d="M7 10l5 5 5-5"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </button>

    @if (open()) {
    <ul
      #menu
      role="listbox"
      (click)="$event.stopPropagation()"
      [ngStyle]="menuStyles"
      [class]="'fixed bg-white rounded-md shadow-lg py-1 ' + (menuClass || '')"
    >
      @for (opt of normalizedOptions; track getValue(opt)) {
      <li role="option">
        <button
          type="button"
          (click)="selectOption(opt)"
          [class]="
            (itemClass || '') + ' flex items-center w-full text-left px-4 py-2'
          "
        >
          @if (getImage(opt)) {
          <img
            [src]="getImage(opt)"
            class="w-5 h-5 mr-3 rounded-full flex-shrink-0"
          />
          } @else if (!getImage(opt) && getIcon(opt)) {
          <span
            class="inline-flex items-center justify-center w-5 h-5 mr-3 flex-shrink-0"
            >{{ getIcon(opt) }}</span
          >
          }
          <span class="truncate">{{ getLabel(opt) }}</span>
        </button>
      </li>
      } @empty {
      <li class="px-4 py-2 text-sm text-gray-500">No options</li>
      }
    </ul>
    }
  </div>
</div>
