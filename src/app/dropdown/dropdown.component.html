<div
  [class]="'inline-block ' + (hostClass || '')"
  [attr.data-open]="open$ | async"
>
  <!-- Unified button: show selected label or fallback text -->
  <button
    #button
    type="button"
    (click)="toggle()"
    (keydown)="onButtonKeydown($event)"
    aria-haspopup="true"
    [attr.aria-expanded]="open$ | async"
    [class]="
      'inline-flex items-center gap-2 px-3 py-2 rounded bg-sky-600 text-white font-medium focus:outline-none focus:ring-2 focus:ring-sky-400 ' +
      (buttonClass || '')
    "
  >
    @if (selectedOption$ | async; as sel) {
      @if (sel?.img_path) {
        <img [src]="sel.img_path" alt="" class="w-4 h-4 rounded-full" />
      } @else if (!sel?.img_path && sel?.icon) {
        <span class="w-4 h-4 inline-flex items-center justify-center">{{ sel.icon }}</span>
      }
      <span class="ml-1">{{ sel?.label }}</span>
    } @else {
      {{ selectedLabel() || 'Options' }}
    }
    <svg
      class="ml-1"
      width="16"
      height="16"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M7 10l5 5 5-5"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
  </button>
  @if (open$ | async) {
  <ul
    #menu
    role="menu"
    [ngStyle]="menuStyles"
    [class]="'fixed bg-white rounded-md shadow-lg py-1 ' + (menuClass || '')"
  >
    @for (opt of options; track opt.value) {
    <li role="none">
      <button
        role="menuitem"
        type="button"
        (click)="selectOption(opt)"
        [class]="
          'flex items-center gap-2 w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 ' +
          (itemClass || '')
        "
      >
        @if (opt.img_path) {
          <img [src]="opt.img_path" alt="" class="w-4 h-4 rounded-full" />
        } @else if (!opt.img_path && opt.icon) {
          <span class="w-4 h-4 inline-flex items-center justify-center">{{ opt.icon }}</span>
        }
        <span>{{ opt.label }}</span>
      </button>
    </li>
    } @empty {
    <li class="px-4 py-2 text-sm text-gray-500">No options</li>
    }
  </ul>
  }
</div>
