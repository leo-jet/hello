<div class="flex h-screen bg-gray-50">
  <!-- Sidebar -->
  <app-sidebar [isOpen]="sidebarOpen()" (closeEvent)="closeSidebar()">
    <!-- Header de la sidebar -->
    <div slot="header">
      <!-- Logo et titre -->
      <div class="mb-4 flex items-center space-x-2">
        <div class="w-8 h-8 rounded flex items-center justify-center">
          <img src="gemini.png" alt="Gemini Logo" class="w-full h-full object-contain">
        </div>
        <h2 class="text-lg font-semibold text-gray-900">ChatApp</h2>
      </div>

      <!-- Navigation principale -->
      <app-main-sidebar-navigation
        [currentChatMode]="currentChatMode()"
        [currentRoute]="currentRoute()"
        [chatModes]="chatModes"
        [chatModesExpanded]="chatModesExpanded()"
        (homeClick)="navigateToHome()"
        (docsClick)="navigateToDocs()"
        (newChatClick)="createNewChat()"
        (chatModeClick)="navigateToChatMode($event)"
        (toggleChatModes)="toggleChatModesMenu()"
      />
    </div>

    <!-- Contenu de la sidebar -->
    <div slot="content" class="px-4 py-2">
      <!-- Liste des conversations -->
      <div class="mb-2 flex items-center justify-between">
        <h3 class="text-xs font-semibold text-gray-500 uppercase">
          Conversations
        </h3>
      </div>

      <app-list>
        @for (conversation of chatStore.conversations(); track conversation.id) {
          <app-main-conversation-item
            [conversation]="conversation"
            (conversationClick)="navigateToChat($event.id)"
            (deleteClick)="handleDeleteConversation($event)"
          />
        }
      </app-list>
    </div>

    <!-- Footer de la sidebar -->
    <div slot="footer" class="p-4 border-t">
      <!-- Menu actions -->
      <app-list [dense]="true">
        <!-- Paramètres -->
        <app-list-item (activate)="openSettingsDialog()">
          <app-list-item-section [avatar]="true">
            <i class="fas fa-cog text-lg"></i>
          </app-list-item-section>
          <app-list-item-section>
            <app-list-item-label>Paramètres</app-list-item-label>
          </app-list-item-section>
        </app-list-item>

        <!-- Profil -->
        <app-list-item (activate)="openProfileDialog()">
          <app-list-item-section [avatar]="true">
            <i class="fas fa-user text-lg"></i>
          </app-list-item-section>
          <app-list-item-section>
            <app-list-item-label>Profil</app-list-item-label>
          </app-list-item-section>
        </app-list-item>

        <!-- Aide -->
        <app-list-item (activate)="openHelpDialog()">
          <app-list-item-section [avatar]="true">
            <i class="fas fa-question-circle text-lg"></i>
          </app-list-item-section>
          <app-list-item-section>
            <app-list-item-label>Aide</app-list-item-label>
          </app-list-item-section>
        </app-list-item>
      </app-list>
    </div>
  </app-sidebar>

  <!-- Zone principale avec header et contenu -->
  <div class="flex-1 flex flex-col overflow-hidden md:ml-80 transition-all">
    <!-- Header avec ng-content -->
    <app-header
      [title]="title"
      [showNotificationButton]="true"
      [notificationCount]="3"
      (toggleEvent)="toggleSidebar()"
    >
      <!-- Contenu header personnalisé -->
      <div slot="left">
        <ng-content select="[header]"> {{chatStore.selectedModel()?.name || 'Aucun modèle'}}</ng-content>
      </div>

      <!-- Actions additionnelles -->

    </app-header>

    <!-- Contenu principal -->
    <main class="flex-1 overflow-y-auto bg-gray-50">
      <div class="p-8">
        <ng-content></ng-content>
        <router-outlet></router-outlet>
      </div>
    </main>

    <!-- Footer optionnel -->
    <ng-content select="[footer]"></ng-content>
  </div>

  <!-- Overlay pour mobile -->
  <app-overlay [show]="sidebarOpen()" (clickEvent)="closeSidebar()">
  </app-overlay>

  <!-- Dialogs -->
  <app-settings-dialog [(visible)]="settingsDialogVisible" />
  <app-profile-dialog [(visible)]="profileDialogVisible" />
  <app-help-dialog [(visible)]="helpDialogVisible" />
</div>
